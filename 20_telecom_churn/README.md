# Предсказание оттока клиентов
### Постановка задачи
Заказчик исследования - оператор связи "Теледом", желание заказчика - бороться с оттоком клиентов. Задача - на основании датасета о клиентах компании "Теледом" разработать модель, которая будет предсказывать риск отвала клиента. Модель планируется использовать в бизнесе для проактивных действий по предотвращению отвала клиентов.

### Исходные данные
Исходные данные представляют собой SQL базу данных из четырех таблиц. Данные содержат пропуски, но их количество невелико. Аномалий данных и выбросов не обраружено. Поля для связи таблиц есть, данные можно успешно объединить. В целом датасет пригоден для дальнейшей работы. Данные актуальны на февраль 2020 года.

### Предобработка данных
В ходе предобработки данных было произведено переименование колонок, заполнение пропусков, изменение типов данных на наиболее подходящие. 

### Формирование датасета для обучения моделей
На основании исходной базы данных был сформирован датасет для обучения моделей. Для этого были сформированы новые признаки:
* `lifetime` - срок жизни клиента;
* `has_churned` - целевой признак, обозначающий факт отвала клиента

Были убраны лишние колонки `customer_id`, `begin_date`, `end_date`. 

В объединенном датасете осталось 7_043 строк, 20 обучающих признаков и один целевой признак. 

### Исследование корреляций в исходном датасете
Корреляции целевого признака в исходном датасете слабые. Есть слабая отрицательная корреляция с признаком `total_charges` (K = -0.23, то есть чем меньше заплатил клиент, тем выше вероятность, что он разорвет контракт) и слабая положительная корреляция с колонкой `internet` (K = 0.23, клиенты, которые пользуются интернетом, более склонны к разрыву контракта).

Некоторые обучающие признаки коррелированы между собой, в том числе сильно (K > 0.6): это `monthly_charges` и `total_charges` - они коррелированы между собой, а также с услугами, которые повышают стоимость: это `internet`, `streaming_tv`, `streaming_movies`, средней и слабой силы корреляции с такими услугами как `multiple_lines`, `online_backup` и др.

### Обучение моделей
#### Тип решаемой задачи
Поскольку целевой признак представлен колонкой 'has_churned' и  в ней единицы и нули, то будем решать задачу бинарной классификации.

#### Метрика
В качестве ключевой метрики выбрана AUC ROC score - площадь под кривой ошибок. Заказчику важно верно определить вероятность ухода клиента, то есть важно верно определить объекты и положительного и отрицательного класса.

При такой постановке задачи AUC ROC лучше, чем среднегармоническое F1, т.к. ее сложней обмануть. В частности она показывает, с какой вероятностью объект положительного класса будет оценен моделью выше, чем объект отрицательного класса.

#### Результаты обучения моделей
На датасете обучено четыре вида моделей: решающее дерево, случайный лес, CatBoost и нейронные сети. Гиперпараметры для CatBoost подобраны на RandomizedSearchCV, для дерева и леса - на GridSearchCV. 


На кроссвалидации дерева и леса, как и в логах обучения catboost и нейронок видим ключевую метрику AUC ROC > 0.80. Ниже выведены метрики тех же самых моделей, рассчитанные по предсказаниям этих моделей на валидационных выборках, и AUC ROC значительно ниже.

#### Выбор лучшей модели
 
Лучший результат на кроссвалидации показала модель catboost_2. Настройки для нее первоначально были подобраны на RandomizedSearchCV и немного оптимизированы ручным подбором.

При испытании на тестовой выборке метрики лучшей модели значительно ниже, чем на гридсерче, но примерно соответствуют метрикам, посчитанным на валидации.

### Рекомендации по доработке и использованию модели
Модель нуждается в доработке. Имеет смысл расширить датасет обучающих данных и дообучить модель. 

Возможно, имеет смысл изменить ключевую метрику и оптимизировать метрику полноты предсказаний: компании важно выделить всех клиентов, склонных к отвалу, ложноотрицательные значения являются большей проблемой, чем ложноположительные. Сейчас полнота (recall = 0.78 на тесте) выше, чем точность (precision = 0.55). Для поставленной задачи это нормально.
    
На практике имеет смысл стимулировать клиентов к заключению двухлетних договоров. 

Также стоит проверить, возможно, что-то не в порядке с качеством услуг компании: по какой-то причине клиенты, которые пользуются интернетом от компании "Теледом" (особенно оптоволокном), отваливаются чаще остальных. Возможно, проблемной является основная услуга компании - высокоскоростной доступ в интернет - и нужно работать над ее качеством.